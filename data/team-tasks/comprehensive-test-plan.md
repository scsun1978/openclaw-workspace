# Stock-SimGame v2.0 全面测试计划

> **创建时间**: 2026-02-20  
> **测试目标**: 覆盖所有核心业务场景、边界条件、安全性、性能

---

## 🧪 测试用例分类

### 1. 认证模块 (Auth) - 15 用例
| # | 测试项 | 场景 | 预期结果 |
|---|--------|------|----------|
| 1.1 | 用户注册 - 正常 | 有效邮箱+密码 | 返回 userId, 默认 $100,000 |
| 1.2 | 用户注册 - 重复邮箱 | 已存在邮箱 | 返回 "Email already exists" |
| 1.3 | 用户注册 - 无效邮箱 | 格式错误邮箱 | 返回 "Invalid email format" |
| 1.4 | 用户注册 - 弱密码 | 少于6位密码 | 返回 "Password too weak" |
| 1.5 | 用户登录 - 正常 | 正确邮箱+密码 | 返回 accessToken, refreshToken |
| 1.6 | 用户登录 - 错误密码 | 正确邮箱+错误密码 | 返回 "Invalid credentials" |
| 1.7 | 用户登录 - 不存在用户 | 不存在邮箱 | 返回 "User not found" |
| 1.8 | Token 验证 - 有效 | 有效 Bearer token | 返回用户信息 |
| 1.9 | Token 验证 - 过期 | 过期 token | 返回 "Token expired" |
| 1.10 | Token 验证 - 无效 | 伪造 token | 返回 "Invalid token" |
| 1.11 | Token 刷新 - 正常 | 有效 refreshToken | 返回新 accessToken |
| 1.12 | Token 刷新 - 无效 | 无效 refreshToken | 返回 "Invalid refresh token" |
| 1.13 | 登出 - 正常 | 清除 token | Token 失效 |
| 1.14 | 并发登录 | 同一用户多次登录 | 生成多个有效 token |
| 1.15 | 权限隔离 | 用户A访问用户B资源 | 返回 403 Forbidden |

### 2. 交易模块 (Trading) - 25 用例
| # | 测试项 | 场景 | 预期结果 |
|---|--------|------|----------|
| 2.1 | 市价买入 - 正常 | 余额充足 | 订单 FILLED, 持仓+余额更新 |
| 2.2 | 市价买入 - 余额不足 | 余额 < 订单金额 | 返回 "Insufficient balance" |
| 2.3 | 市价买入 - 无效股票 | 不存在的 symbol | 返回 "Invalid symbol" |
| 2.4 | 市价买入 - 数量为0 | quantity=0 | 返回 "Quantity must be positive" |
| 2.5 | 市价买入 - 负数数量 | quantity=-10 | 返回 "Quantity must be positive" |
| 2.6 | 市价买入 - 小数数量 | quantity=1.5 | 返回 "Quantity must be integer" |
| 2.7 | 市价买入 - 超大数量 | quantity=999999 | 余额不足或成功 |
| 2.8 | 市价卖出 - 正常 | 持仓充足 | 订单 FILLED, 持仓-余额更新 |
| 2.9 | 市价卖出 - 持仓不足 | 持仓 < 卖出量 | 返回 "Insufficient shares" |
| 2.10 | 市价卖出 - 无持仓 | 未持有该股票 | 返回 "No position found" |
| 2.11 | 限价买入 - 正常 | 有效限价单 | 订单 PENDING, 冻结资金 |
| 2.12 | 限价买入 - 价格为0 | price=0 | 返回 "Price must be positive" |
| 2.13 | 限价买入 - 负数价格 | price=-100 | 返回 "Price must be positive" |
| 2.14 | 限价卖出 - 正常 | 有效限价卖单 | 订单 PENDING, 冻结持仓 |
| 2.15 | 限价单撮合 - 价格触发 | 市价达到限价 | 订单 FILLED |
| 2.16 | 限价单取消 - 正常 | 取消 PENDING 订单 | 订单 CANCELLED, 解冻资金 |
| 2.17 | 限价单取消 - 已成交 | 取消 FILLED 订单 | 返回 "Order already filled" |
| 2.18 | 订单查询 - 全部 | 获取所有订单 | 返回订单列表 |
| 2.19 | 订单查询 - 按状态 | status=PENDING | 返回挂单列表 |
| 2.20 | 订单查询 - 按股票 | symbol=AAPL | 返回该股票订单 |
| 2.21 | 订单查询 - 分页 | page=2, limit=10 | 返回第2页数据 |
| 2.22 | 持仓查询 - 全部 | 获取所有持仓 | 返回持仓列表 |
| 2.23 | 持仓查询 - 单只股票 | symbol=AAPL | 返回该股票持仓 |
| 2.24 | 持仓成本计算 | 多次买入 | 计算加权平均成本 |
| 2.25 | 订单历史 - 时间范围 | startDate, endDate | 返回时间范围订单 |

### 3. 行情模块 (Market) - 12 用例
| # | 测试项 | 场景 | 预期结果 |
|---|--------|------|----------|
| 3.1 | 价格查询 - 全部 | 获取所有股票价格 | 返回价格列表 |
| 3.2 | 价格查询 - 单只 | symbol=AAPL | 返回该股票价格 |
| 3.3 | 价格查询 - 无效股票 | symbol=INVALID | 返回 "Symbol not found" |
| 3.4 | K线数据 - 日线 | interval=1d | 返回日线K线 |
| 3.5 | K线数据 - 小时线 | interval=1h | 返回小时K线 |
| 3.6 | K线数据 - 时间范围 | startDate, endDate | 返回范围K线 |
| 3.7 | K线数据 - 空范围 | 未来日期范围 | 返回空数组 |
| 3.8 | 订单簿 - 正常 | symbol=AAPL | 返回买卖盘 |
| 3.9 | 订单簿 - 空订单簿 | 无挂单股票 | 返回空买卖盘 |
| 3.10 | WebSocket 连接 | 建立连接 | 连接成功 |
| 3.11 | WebSocket 推送 | 价格变动 | 收到推送消息 |
| 3.12 | WebSocket 断线 | 网络中断 | 自动重连 |

### 4. 游戏化模块 (Gamification) - 15 用例
| # | 测试项 | 场景 | 预期结果 |
|---|--------|------|----------|
| 4.1 | 任务列表 - 全部 | 获取所有任务 | 返回任务+进度 |
| 4.2 | 任务进度 - 首次交易 | 完成第一笔交易 | 进度更新 |
| 4.3 | 任务进度 - 累计交易 | 达成交易量目标 | 进度100% |
| 4.4 | 任务领取 - 正常 | 完成任务后领取 | 奖励发放 |
| 4.5 | 任务领取 - 未完成 | 进度<100%领取 | 返回 "Task not completed" |
| 4.6 | 任务领取 - 重复领取 | 已领取任务再领 | 返回 "Already claimed" |
| 4.7 | 成就列表 - 全部 | 获取所有成就 | 返回成就+解锁状态 |
| 4.8 | 成就解锁 - 首次登录 | 第一次登录 | 解锁成就 |
| 4.9 | 成就解锁 - 交易达人 | 达成交易次数 | 解锁成就 |
| 4.10 | 成就解锁 - 赚钱王 | 盈利达到目标 | 解锁成就 |
| 4.11 | 排行榜 - 收益率 | type=profit_rate | 返回收益排行 |
| 4.12 | 排行榜 - 总资产 | type=total_assets | 返回资产排行 |
| 4.13 | 排行榜 - 交易量 | type=volume | 返回交易量排行 |
| 4.14 | 排行榜 - 分页 | page=1, limit=10 | 返回前10名 |
| 4.15 | 排行榜更新 | 交易后 | 排名实时更新 |

### 5. 社交模块 (Social) - 10 用例
| # | 测试项 | 场景 | 预期结果 |
|---|--------|------|----------|
| 5.1 | 动态列表 - 全部 | 获取所有动态 | 返回动态列表 |
| 5.2 | 发布动态 - 文字 | content="test" | 创建成功 |
| 5.3 | 发布动态 - 空 | content="" | 返回 "Content cannot be empty" |
| 5.4 | 发布动态 - 超长 | 10000字符 | 截断或拒绝 |
| 5.5 | 点赞 - 正常 | 点赞动态 | 点赞数+1 |
| 5.6 | 点赞 - 重复 | 再次点赞 | 取消点赞 |
| 5.7 | 关注 - 正常 | 关注用户 | 关注成功 |
| 5.8 | 关注 - 自己 | 关注自己 | 返回 "Cannot follow yourself" |
| 5.9 | 粉丝列表 | 获取粉丝 | 返回粉丝列表 |
| 5.10 | 关注列表 | 获取关注 | 返回关注列表 |

### 6. 账户模块 (Account) - 10 用例
| # | 测试项 | 场景 | 预期结果 |
|---|--------|------|----------|
| 6.1 | 账户信息 - 正常 | 获取账户信息 | 返回余额、持仓等 |
| 6.2 | 账户信息 - 未登录 | 无 token | 返回 "No token provided" |
| 6.3 | 交易历史 - 全部 | 获取所有交易 | 返回交易记录 |
| 6.4 | 交易历史 - 按类型 | type=buy | 返回买入记录 |
| 6.5 | 资金流水 - 全部 | 获取资金变动 | 返回流水记录 |
| 6.6 | 资金流水 - 按类型 | type=deposit | 返回存款记录 |
| 6.7 | 账户设置 - 更新昵称 | 修改昵称 | 更新成功 |
| 6.8 | 账户设置 - 更新头像 | 上传头像 | 更新成功 |
| 6.9 | 账户统计 - 盈亏 | 计算总盈亏 | 返回盈亏金额 |
| 6.10 | 账户统计 - 收益率 | 计算收益率 | 返回收益率% |

### 7. 边界条件 & 异常 - 15 用例
| # | 测试项 | 场景 | 预期结果 |
|---|--------|------|----------|
| 7.1 | 并发下单 | 同时下多个订单 | 正确处理并发 |
| 7.2 | 重复请求 | 重复提交同一订单 | 幂等处理 |
| 7.3 | 请求超时 | 慢查询 | 返回超时错误 |
| 7.4 | 大数据量 | 查询1000条订单 | 正确分页 |
| 7.5 | SQL注入 | symbol="AAPL'; DROP--" | 安全处理 |
| 7.6 | XSS攻击 | content="<script>alert(1)</script>" | 安全过滤 |
| 7.7 | 参数缺失 | 缺少必填字段 | 返回明确错误 |
| 7.8 | 参数类型错误 | quantity="abc" | 返回类型错误 |
| 7.9 | 空值处理 | symbol=null | 返回明确错误 |
| 7.10 | 特殊字符 | symbol="AAPL@#$" | 返回格式错误 |
| 7.11 | Unicode | 中文昵称 | 正确处理 |
| 7.12 | 时区处理 | 跨时区查询 | 统一时区 |
| 7.13 | 金额精度 | $0.0001 交易 | 正确处理精度 |
| 7.14 | 数值溢出 | Integer.MAX_VALUE | 返回溢出错误 |
| 7.15 | 负数金额 | balance=-100 | 返回格式错误 |

### 8. 性能测试 - 8 用例
| # | 测试项 | 场景 | 预期结果 |
|---|--------|------|----------|
| 8.1 | 登录响应时间 | 正常登录 | < 500ms |
| 8.2 | 下单响应时间 | 市价单 | < 300ms |
| 8.3 | 持仓查询时间 | 10只持仓 | < 200ms |
| 8.4 | K线查询时间 | 1年数据 | < 500ms |
| 8.5 | 排行榜查询 | 1000用户 | < 300ms |
| 8.6 | 并发100用户 | 同时请求 | 无错误 |
| 8.7 | 并发500用户 | 压力测试 | 响应时间合理 |
| 8.8 | 长连接稳定性 | WebSocket 1小时 | 不断线 |

---

## 📊 统计

| 模块 | 用例数 |
|------|--------|
| 认证模块 | 15 |
| 交易模块 | 25 |
| 行情模块 | 12 |
| 游戏化模块 | 15 |
| 社交模块 | 10 |
| 账户模块 | 10 |
| 边界条件 | 15 |
| 性能测试 | 8 |
| **总计** | **110** |

